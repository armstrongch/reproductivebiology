<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Reproductive Biology</title>
		<style type="text/css">
			#gameCanvas {
				outline: solid 1px black;
			}
			#infoDiv {
				outline: solid 1px black;
				height: 480px;
				width: 640px;
				text-align: center;
			}
			#buttonDiv {
				text-align: center;
				width: 640px;
				margin: 10px;
			}
			#previousButton, nextButton {
				display: inline-block;
			}
		</style>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no" />
	</head>
	<body onload="loadPage()">
		<div id="infoDiv">
			<h1 id="header"></h1>
			<h2 id="description"><h2>
			<h2 id="instructions"><h2>
			<h2>Press Space to Begin!</h2>
		</div>
		<canvas id="gameCanvas" width="0" height="0"></canvas>
		<div id="buttonDiv">
			<button id="previousButton" onclick="previousTask()"><h3>Previous Task</h3></button>
			<button id="nextButton" onclick="nextTask()"><h3>Next Task</h3></button>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
		<script type="text/javascript">
		
			var gameCanvas = document.getElementById("gameCanvas");
			var ctx = gameCanvas.getContext("2d");
			
			var mode = "info";
			var taskIndex = 0;
			var gameInterval;
			
			var tasks = 
			[
				{
					header: "Finding an Egg",
					description: "Educational description goes here.",
					instructions: "Instructions to play the game go here."
				},
				{
					header: "Calcium Collection",
					description: "Educational description goes here.",
					instructions: "Instructions to play the game go here."
				},
				{
					header: "ZP3 Binding",
					description: "Educational description goes here.",
					instructions: "Instructions to play the game go here."
				}
			];
			
			var gameLoops =
			[
				taskOne,
				function() {
					console.log("Task Two Loop");
				},
				function() {
					console.log("Task Three Loop");
				}
			];
			
			var taskSetUp = [];
			
			function showInfo()
			{
				$(gameCanvas).css('display', 'none');
				$('#infoDiv').css('display', 'block');
				
				var task = tasks[taskIndex];
				$('#header').html(task.header);
				$('#description').html(task.description);
				$('#instructions').html(task.instructions);
				
				resetTasks();
				
				mode = "info";
				setupButtons();
				clearInterval(gameInterval);
			}
			
			function showGame()
			{
				$(gameCanvas).css('display', 'block');
				$('#infoDiv').css('display', 'none');
				
				mode = "game";
				
				gameInterval = setInterval(gameLoops[taskIndex], 35); //Approx 30 frames per second
			}
			
			function resetTasks()
			{
				for (let i = 0; i < taskSetUp.length; i++)
				{
					taskSetUp[i] = false;
				}
			}
			
			function loadPage()
			{
				gameCanvas.width = 640;
				gameCanvas.height = 480;
				
				for (let i = 0; i < tasks.length; i++)
				{
					taskSetUp.push(false);
				}
				
				document.addEventListener('keydown', (e) => 
					{
						if (e.code === "ArrowUp")
						{
							arrowPressed("Up");
						}
						else if (e.code === "ArrowDown")
						{
							arrowPressed("Down");
						}
						else if (e.code === "ArrowLeft")
						{
							arrowPressed("Left");
						}
						else if (e.code === "ArrowRight")
						{
							arrowPressed("Right");
						}
						else if (e.code === "Space") //A
						{
							spacePressed();
						}
					}
				);
				
				document.addEventListener('keyup', (e) => 
					{
						if (e.code === "ArrowUp")
						{
							arrowReleased("Up");
						}
						else if (e.code === "ArrowDown")
						{
							arrowReleased("Down");
						}
						else if (e.code === "ArrowLeft")
						{
							arrowReleased("Left");
						}
						else if (e.code === "ArrowRight")
						{
							arrowReleased("Right");
						}
						else if (e.code === "Space") //A
						{
							spaceReleased();
						}
					}
				);
				
				taskIndex = 0;
				showInfo();
			}
			
			function setupButtons()
			{
				$('#nextButton').css('min-width', $('#previousButton').css('width'));
				$('#previousButton').prop('disabled', taskIndex == 0);
				$('#nextButton').prop('disabled', taskIndex == tasks.length - 1);
			}
			
			function previousTask()
			{
				if (taskIndex > 0)
				{
					taskIndex--;
					showInfo();
				}
			}
			
			function nextTask()
			{
				if (taskIndex < tasks.length - 1)
				{
					taskIndex++;
					showInfo();
				}
			}
			
			var up = false;
			var down = false;
			var left = false;
			var right = false;
			var space = false;
			
			function arrowPressed(direction)
			{
				console.log("Pressed " + direction + "!");
				switch (direction)
				{
					case "Up":
						up = true;
						break;
					case "Down":
						down = true;
						break;
					case "Left":
						left = true;
						break;
					case "Right":
						right = true;
						break;
				}
			}
			
			function arrowReleased(direction)
			{
				console.log("Released " + direction + "!");
				switch (direction)
				{
					case "Up":
						up = false;
						break;
					case "Down":
						down = false;
						break;
					case "Left":
						left = false;
						break;
					case "Right":
						right = false;
						break;
				}
			}
			
			function spacePressed()
			{
				if (mode == "info")
				{
					showGame(taskIndex);
				}
				else
				{
					console.log("Pressed Space!");
					space = true;
				}
			}
			
			function spaceReleased()
			{
				console.log("Released Space!");
				space = false;
			}
			
			// Tasks
			
			var distanceBetweenPoints = 32;
			var maxHeightDifferential = 90; //get rid of this
			var minDistFromCenter = 120;
			var maxDistFromCenter = 180;
			var maxCurveHeight = 32;
			var centerHeight = 240;
			var topPoints = [];
			var bottomPoints = [];
			
			var PointsGenerated;
			var mostRecentGeneratedTopHeight;
			var mostRecentGeneratedBottomHeight;
			
			var lightPink = '#ffc4bc';
			var darkPink = '#ff7379';
			var black = '#000000';
			
			function setupTaskOne()
			{
				console.log("Setting up Task One");
				taskSetUp[taskIndex] = true;
				
				pointsGenerated = 0;
				
				for (let i = 0; i < 640 + distanceBetweenPoints*3; i += distanceBetweenPoints)
				{
					addPoints(i);
				}
			}
			
			function addPoints(xCoordinate)
			{
				if (pointsGenerated == 0)
				{
					mostRecentGeneratedTopHeight = centerHeight - minDistFromCenter - Math.floor((Math.random() * (maxDistFromCenter - minDistFromCenter)));
					mostRecentGeneratedBottomHeight = centerHeight - minDistFromCenter - Math.floor((Math.random() * (maxDistFromCenter - minDistFromCenter)));
				}
				else
				{
					mostRecentGeneratedTopHeight = mostRecentGeneratedTopHeight - maxCurveHeight/2 + maxCurveHeight*Math.random();
					mostRecentGeneratedBottomHeight = mostRecentGeneratedBottomHeight - maxCurveHeight/2 + maxCurveHeight*Math.random();
				}
				
				pointsGenerated++;
				if (pointsGenerated == 2)
				{
					pointsGenerated = 0;
				}
				
				topPoints.push(
					{x: xCoordinate, y: mostRecentGeneratedTopHeight}
				);
				bottomPoints.push(
					{x: xCoordinate, y: mostRecentGeneratedBottomHeight}
				);
			}
			
			function taskOne()
			{
				if (taskSetUp[taskIndex] == false)
				{
					setupTaskOne();
				}
				
				//Move points to the left
				for (let i = 0; i < topPoints.length; i++)
				{
					topPoints[i].x--;
				}
				
				if (topPoints[0].x < -distanceBetweenPoints)
				{
					topPoints.shift();
					addPoints(topPoints[topPoints.length-1].x+distanceBetweenPoints)
				}
				
				drawTaskOne();
				console.log("Task One Loop");
			}
			
			function drawTaskOne()
			{
				ctx.fillStyle = lightPink;
				
				//Background
				ctx.beginPath();
				ctx.fillRect(0, 0, 640, 480);
				
				//Top Walls
				ctx.fillStyle = darkPink;
				ctx.beginPath();
				ctx.moveTo(0, 0);
				for (let i = 0; i < topPoints.length - 1; i++)
				{
					ctx.lineTo(topPoints[i].x, topPoints[i].y);
				}
				ctx.lineTo(640, 0);
				ctx.closePath();
				ctx.fill();
				
				//Bottom Walls
				/*ctx.beginPath();
				ctx.moveTo(0, 480);
				for (let i = 0; i < topPoints.length - 1; i++)
				{
					ctx.lineTo(topPoints[i].x, centerHeight + topPoints[i].y);
				}
				ctx.lineTo(640, 480);
				ctx.closePath();
				ctx.fill();*/
				
				//Lines
				ctx.strokeStyle = black;
				ctx.beginPath();
				for (let i = 0; i < topPoints.length - 1; i++)
				{
					ctx.moveTo(topPoints[i].x, topPoints[i].y);
					ctx.lineTo(topPoints[i+1].x, topPoints[i+1].y);
					
					//ctx.moveTo(topPoints[i].x, centerHeight + topPoints[i].y);
					//ctx.lineTo(topPoints[i+1].x, centerHeight + topPoints[i+1].y);
				}
				ctx.stroke();
			}
			
		</script>
	</body>
</html>
